{% extends "base.html" %}
{% load static %}

{% block content %}




    <div class="container">


        <div class="Transition full-height">
            <div id="Main" class="left-column-shown left-column-open Transition_slide Transition_slide-active">
                <div id="LeftColumn" class="Transition">
                    <div id="LeftColumn-main" class="Transition_slide Transition_slide-active">
                        <div class="LeftMainHeader">
                            <div id="LeftMainHeader" class="left-header">
                                <div class="DropdownMenu main-menu">
                                    <button type="button" class="Button smaller translucent round"
                                            aria-label="Open menu" title="Open menu">
                                        <div class="animated-menu-icon">

                                        </div>
                                    </button>
                                    <div class="Menu compact main-menu">
                                        <div role="presentation"
                                             class="bubble menu-container custom-scroll top left with-footer opacity-transition fast not-open not-shown"
                                             style="transform-origin: left top;">
                                            <div role="menuitem" tabindex="0" class="MenuItem compact">
                                                <i class="icon icon-saved-messages"></i>
                                                Saved Messages
                                            </div>
                                            <div role="menuitem" tabindex="0" class="MenuItem compact">
                                                <i class="icon icon-user"></i>
                                                Contacts
                                            </div>
                                            <div role="menuitem" tabindex="0" class="MenuItem compact">
                                                <i class="icon icon-play-story"></i>
                                                My Stories
                                            </div>
                                            <div role="menuitem" tabindex="0" class="MenuItem compact">
                                                <i class="icon icon-settings"></i>
                                                Settings
                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="Transition">
                            <div class="ChatFolders not-open not-shown Transition_slide Transition_slide-active">
                                <div class="Transition" x-data>
                                    <template x-for="chat in $store.chatsData.chats">
                                    <div class="chat-list custom-scroll Transition_slide Transition_slide-active"
                                         style="transition: none 0s ease 0s; transform: translate3d(0px, 0px, 0px);">
                                        <div class="overscroll-trigger" style="display: block;"></div>
                                        <div style="position: relative;">
                                            <div class="ListItem Chat chat-item-clickable private" style="top: 0px;"><a
                                                    class="ListItem-button" role="button" href="#488699562"
                                                    tabindex="0">
                                                <div class="status status-clickable">
                                                    <div class="Avatar size-large peer-color-1" id="peer-story488699562"
                                                         data-peer-id="488699562">
                                                        <div class="inner"><img
                                                                src=""
                                                                class="Avatar__media avatar-media opacity-transition slow open shown"
                                                                alt="Артем К" decoding="async" draggable="false"></div>
                                                    </div>
                                                    <div class="avatar-badge-wrapper">
                                                        <div class="avatar-online"></div>
                                                    </div>
                                                </div>
                                                <div class="info">
                                                    <div class="info-row">
                                                        <div class="title QljEeKI5"><h3 dir="auto" role="button"
                                                                                        class="fullName AS54Cntu">Артем
                                                            К</h3>
                                                        </div>
                                                        <div class="separator"></div>
                                                        <div class="LastMessageMeta"><span class="time">Sun</span></div>
                                                    </div>
                                                    <div class="subtitle">
                                                        <p
                                                                class="last-message shared-canvas-container"
                                                                dir="ltr"><span
                                                                class="media-preview"><img
                                                                src=""
                                                                alt="" class="media-preview--image"
                                                                draggable="false"><span>https://www.fontanka.ru/2024/05/25/73622801/</span></span>
                                                        </p>
                                                        <div class="ChatBadge-transition open shown">
                                                            <div class="ChatBadge muted unread"><span
                                                                    class="tgKbsVmz"><span>2</span><span>1</span><span>1</span></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a></div>
                                        </template>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="NewChatButton">
                            <button type="button" class="Button default primary round" aria-label="New Message"
                                    title="New Message" tabindex="-1"><i class="icon icon-new-chat-filled"></i><i
                                    class="icon icon-close"></i></button>
                            <div class="Menu compact">
                                <div role="presentation"
                                     class="bubble menu-container custom-scroll bottom right opacity-transition fast not-open not-shown"
                                     style="transform-origin: right bottom;">
                                    <div role="menuitem" tabindex="0" class="MenuItem compact"><i
                                            class="icon icon-channel"></i>Связаться с модератором
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="MiddleColumn" class="mask-image-disabled"
                     style="--composer-hidden-scale: 1; --toolbar-hidden-scale: 1; --unpin-hidden-scale: 1.941860465116279; --toolbar-unpin-hidden-scale: 0.5149700598802395,; --composer-translate-x: 0px; --toolbar-translate-x: 0px; --pattern-color: #0A0A0A8C;">
                    <div class="C6IaXYew nXhZtCma"></div>
                    <div id="middle-column-portals"></div>
                    <div class="messages-layout">
                        <div class="MiddleHeader">
                            <div class="Transition">
                                <div class="Transition_slide Transition_slide-active">
                                    <div class="back-button">
                                        <button type="button" class="Button smaller translucent round" aria-label="Back"
                                                title="Back">
                                            <div class="animated-close-icon state-back"></div>
                                        </button>
                                        <div class="unread-count active">146</div>
                                    </div>
                                    <div class="chat-info-wrapper">
                                        <div class="ChatInfo">
                                            <div class="Avatar size-medium peer-color-5 interactive"
                                                 id="peer-story115263265" data-peer-id="115263265">

                                            </div>
                                            <div class="info">
                                                <div class="title QljEeKI5"><h3 dir="auto" role="button"
                                                                                class="fullName AS54Cntu">Ella️</h3>
                                                </div>
                                                <span class="status"><span class="user-status" dir="auto">last seen recently</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="HeaderPinnedMessageWrapper Guj4V7W_ opacity-transition fast open shown">
                                <button type="button" class="Button smaller translucent round"
                                        aria-label="Unpin message" title="Unpin message"><i class="icon icon-close"></i>
                                </button>
                                <div class="GgG7nh8p">

                                    <div class="Transition ud4LJMTI">
                                        <div class="Transition_slide Transition_slide-active">
                                            <div class="_M8tJtJD"></div>
                                        </div>
                                    </div>
                                    <div class="LPdDfCw0">
                                        <div class="bY9umAoY" dir="auto"><span
                                                class="tgKbsVmz"><span>P</span><span>i</span><span>n</span><span>n</span><span>e</span><span>d</span><span> </span><span>M</span><span>e</span><span>s</span><span>s</span><span>a</span><span>g</span><span>e</span><span> </span></span>
                                        </div>
                                        <div class="Transition lo853Tki">
                                            <div class="Transition_slide Transition_slide-active"><p dir="auto"
                                                                                                     class="Ko14czNN">
                                                <span>Я тебе рекомендую взять макбарен</span></p></div>
                                        </div>
                                    </div>
                                    <div class="ripple-container"></div>
                                </div>
                            </div>
                            <div class="header-tools">
                                <div class="HeaderActions">
                                    <button type="button" class="Button smaller translucent round"
                                            aria-label="Search this chat" title="Search this chat"><i
                                            class="icon icon-search" aria-hidden="true"></i></button>
                                    <button type="button" class="Button smaller translucent round" aria-label="Call"
                                            title="Call"><i class="icon icon-phone" aria-hidden="true"></i></button>
                                    <button type="button" class="Button smaller translucent round has-ripple"
                                            aria-label="More actions" title="More actions"><i class="icon icon-more"
                                                                                              aria-hidden="true"></i>
                                        <div class="ripple-container"></div>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="Transition">
                            <div class="Transition_slide Transition_slide-active">
                                <div class="MessageList custom-scroll no-avatars with-default-bg"
                                     data-normal-height="819">
                                    <div class="messages-container">
                                        <div class="backwards-trigger"></div>
                                        <div class="message-date-group">
                                            <div class="sticky-date interactive"><span dir="auto">Friday</span></div>
                                            <div id="message49819"
                                                 class="Message message-list-item allow-selection last-in-group last-in-list open shown"
                                                 data-message-id="49819">
                                                <div class="bottom-marker" data-message-id="49819"
                                                     data-should-update-views="false"></div>
                                                <div class="message-select-control"></div>
                                                <div class="message-content-wrapper can-select-text">
                                                    <div class="message-content peer-color-5 text has-shadow has-solid-background has-appendix"
                                                         dir="auto" style="">
                                                        <div class="content-inner" dir="auto">
                                                            <div class="text-content clearfix with-meta" dir="auto">
                                                                Счастье в том, чтобы не зависеть от кого-то или
                                                                чего-то<span class="MessageMeta" dir="ltr"
                                                                             data-ignore-on-paste="true"><span
                                                                    class="message-time">22:43</span></span></div>
                                                        </div>
                                                        <div class="message-action-buttons"></div>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="forwards-trigger"></div>
                                        <div class="fab-trigger"></div>
                                    </div>
                                </div>
                                <div class="middle-column-footer">
                                    <div class="Composer shown mounted">

                                        <div class="composer-wrapper">

                                            <div class="message-input-wrapper peer-color-5">

                                                <div id="message-input-text">
                                                    <div class="custom-scroll input-scroller">
                                                        <div class="input-scroller-content">
                                                            <div id="editable-message-text"
                                                                 class="form-control allow-selection"
                                                                 contenteditable="true" role="textbox" dir="auto"
                                                                 tabindex="0" aria-label="Message"
                                                                 style="transition: color 50ms linear 0s !important;"></div>
                                                            <span class="placeholder-text" dir="auto">Message</span>

                                                            <div class="absolute-video-container"></div>
                                                        </div>
                                                    </div>
                                                    <div class="custom-scroll input-scroller clone">
                                                        <div class="input-scroller-content">
                                                            <div class="form-control allow-selection clone"
                                                                 dir="auto"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="AttachMenu">
                                                    <button id="attach-menu-button" type="button"
                                                            class="Button AttachMenu--button default translucent round"
                                                            aria-label="Add an attachment"
                                                            aria-controls="attach-menu-controls" aria-haspopup="true"
                                                            title="Add an attachment"><i class="icon icon-attach"
                                                                                         aria-hidden="true"></i>
                                                    </button>

                                                </div>
                                                <div class="_8sFuAomM composer-tooltip custom-scroll-x not-open not-shown"></div>
                                                <div class="StickerTooltip composer-tooltip custom-scroll not-open not-shown hidden"></div>
                                                <div class="EmojiTooltip composer-tooltip custom-scroll-x not-open not-shown"></div>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div></div>
                </div>
                <div id="RightColumn-wrapper" class="is-hidden">
                    <div class="overlay-backdrop"></div>
                    <div id="RightColumn">
                        <div class="RightHeader">
                            <button type="button" class="Button close-button smaller translucent round"
                                    aria-label="Back" title="Back">
                                <div class="animated-close-icon state-back no-transition"></div>
                            </button>
                            <div class="Transition"></div>
                        </div>
                        <div class="Transition"></div>
                    </div>
                </div>
                <div></div>
            </div>
        </div>


        <div class="row clearfix">
            <div class="col-lg-12">
                <div class="card chat-app">
                    <div id="plist" class="people-list">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fa fa-search"></i></span>
                            </div>
                            <input type="text" class="form-control" placeholder="Search...">
                        </div>
                        <ul class="list-unstyled chat-list mt-2 mb-0" x-data>
                            <template x-for="chat in $store.chatsData.chats">
                                <li class="clearfix" :class="chat.active? 'chat-active': ''" :id="chat.chat_uuid"
                                    x-bind="chat_item">
                                    <img :src="chat.other_user.photo" alt="avatar">
                                    <div class="about">
                                        <div class="name" x-text="chat.other_user.display_name"></div>
                                        <div x-text="chat.chat_title"></div>
                                        <div x-text="chat.not_read_count"></div>
                                        <p x-text="chat.messages.length?chat.messages[chat.messages.length - 1].sender+ ': ' +  chat.messages[chat.messages.length - 1].message: ''"></p>
                                        <template
                                                x-if="chat.messages.length && chat.messages[chat.messages.length - 1].file_name">
                                            <a x-text="chat.messages[chat.messages.length - 1].file_name"
                                               :href="'download/' + chat.messages[chat.messages.length - 1].file_id"
                                               target="_blank"></a>
                                        </template>
                                    </div>
                    </div>
                    </li>
                    </template>

                    </ul>
                </div>
                <div class="chat" x-data>
                    <div class="chat-header clearfix">
                        <div class="row">
                            <div class="col-lg-6">
                                <a href="javascript:void(0);" data-toggle="modal" data-target="#view_info">
                                    <img :src="$store.chatsData.getOtherUser().other_user.photo" alt="avatar">
                                </a>
                                <div class="chat-about">
                                    <h6 class="m-b-0"
                                        x-text="$store.chatsData.getOtherUser().other_user.display_name"></h6>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="chat-history">
                        <ul class="m-b-0"
                            x-data="{self_nick_name: '{{ user.display_name }}', acitve_chat:'$store.chatsData.activeChatUUID'}">
                            <template x-for="message in $store.chatsData.getActiveChatMessages" :key="message.created">
                                <li class="clearfix">
                                    <div class="message-data"
                                         :class="message.sender == self_nick_name? 'text-right' : ''">
                                        <span class="message-data-time"
                                              :class="message.sender == self_nick_name? ' other-message float-right' : 'my-message'"
                                              x-text="message.created"></span>
                                    </div>
                                    <div class="clear"></div>
                                    <template x-if="message.file_name">
                                        <a x-text="message.file_name" :href="'download/' + message.file_id"
                                           target="_blank"></a>
                                    </template>
                                    <template x-if="message.message">
                                        <div class="message "
                                             :class="message.sender == self_nick_name? ' other-message float-right' : 'my-message'"
                                             x-text="message.message"></div>
                                    </template>

                                </li>
                            </template>

                        </ul>
                    </div>
                    <div class="chat-message clearfix" x-data>
                        <div class="input-group mb-0">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="chat-message-submit" x-bind="chat_submit_btn"><i
                                        class="fa fa-send"></i></span>
                            </div>
                            <input type="text" class="form-control" x-bind="chat_text_input"
                                   x-model="$store.chatsData.message" placeholder="Enter text here...">
                        </div>
                    </div>
                    <form enctype="multipart/form-data" method="POST" action="">
                        {% csrf_token %}
                        <div class="form-group">
                            <label>Select file to upload.</label>
                            <input type="file" class="form-control" id="fileupload" placeholder="Select file">
                        </div>
                        <input type="submit" value="Upload" x-bind="file_upload_btn" class="btn btn-success">
                    </form>
                    <div id="uploaded_files"></div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div x-data="{ open: false }">
        <button @click="open = !open">Expand</button>

        <span x-show="open">
        Content...
    </span>
    </div>
    <script src="{% static 'contract/js/chat.js' %}"></script>
    <script>

        const chat = new Chat({{ user.id }}, '{{ chat_id}}')

    </script>
{% endblock content %}